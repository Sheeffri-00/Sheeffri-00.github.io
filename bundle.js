(()=>{"use strict";var t={28:(t,e,r)=>{r.d(e,{Z:()=>a});var i=r(81),n=r.n(i),o=r(645),s=r.n(o)()(n());s.push([t.id,"body {\n    margin: 0;\n}\n\n.content {\n    display: flex;    \n    flex-direction: column;\n    justify-content: stretch;\n    align-items: center;\n}\n\n#canvasContainer {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    padding: 70px 12px;\n    width: 100%;\n    max-width: 450px;    \n    box-sizing: border-box;    \n}\n\n.buttons {\n    display: flex;\n    width: calc(20px + 30%);\n}\n\n.restart {\n    font-size: 20px;\n    width: 100%;\n    border: 0;\n    background-color: #d0d022;\n    color: #ffffff;\n    height: 36px;\n    border-radius: 18px;\n    cursor: pointer;\n    font-weight: bold;\n    letter-spacing: 0.8px;\n    outline: none;\n}",""]);const a=s},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",i=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),i&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),i&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,i,n,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);i&&s[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),r&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=r):h[2]=r),n&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=n):h[4]="".concat(n)),e.push(h))}},e}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function r(t){for(var r=-1,i=0;i<e.length;i++)if(e[i].identifier===t){r=i;break}return r}function i(t,i){for(var o={},s=[],a=0;a<t.length;a++){var l=t[a],c=i.base?l[0]+i.base:l[0],h=o[c]||0,u="".concat(c," ").concat(h);o[c]=h+1;var p=r(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(f);else{var d=n(f,i);i.byIndex=a,e.splice(a,0,{identifier:u,updater:d,references:1})}s.push(u)}return s}function n(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,n){var o=i(t=t||[],n=n||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=r(o[s]);e[a].references--}for(var l=i(t,n),c=0;c<o.length;c++){var h=r(o[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}o=l}}},569:t=>{var e={};t.exports=function(t,r){var i=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(r)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,r)=>{t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var i="";r.supports&&(i+="@supports (".concat(r.supports,") {")),r.media&&(i+="@media ".concat(r.media," {"));var n=void 0!==r.layer;n&&(i+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),i+=r.css,n&&(i+="}"),r.media&&(i+="}"),r.supports&&(i+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={id:i,exports:{}};return t[i](o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.nc=void 0;var i={};(()=>{r.d(i,{J:()=>I,C:()=>M});var t,e=r(379),n=r.n(e),o=r(795),s=r.n(o),a=r(569),l=r.n(a),c=r(565),h=r.n(c),u=r(216),p=r.n(u),f=r(589),d=r.n(f),v=r(28),y={};y.styleTagTransform=d(),y.setAttributes=h(),y.insert=l().bind(null,"head"),y.domAPI=s(),y.insertStyleElement=p(),n()(v.Z,y),v.Z&&v.Z.locals&&v.Z.locals,function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(t||(t={}));var b=function(){function t(t,e){this._tile=t,this.props=e,this.currX=e.startX,this.currY=e.startY,this.props.endX,this.currX,this.props.endY,this.currY,this.velX=(this.props.endX-this.props.startX)/5,this.velY=(this.props.endY-this.props.startY)/5}return t.prototype.act=function(){this.currX+=this.velX,this.currY+=this.velY;var t=Math.abs(this.props.endX-this.currX),e=Math.abs(this.props.endY-this.currY);t<=.1&&e<=.1&&(this.currX=this.props.endX,this.currY=this.props.endY,this.props.onFinish())},t}(),g=function(){function t(t,e){this._tile=t,this.props=e,this.currX=this.props.startX,this.currY=this.props.startY,this.props.endX,this.currX,this.props.endY,this.currY,this.velX=(this.props.endX-this.props.startX)/this.props.duration/5,this.velY=(this.props.endY-this.props.startY)/this.props.duration/5}return t.prototype.act=function(){this.currX+=this.velX,this.currY+=this.velY;var t=this.props.startX<=this.props.endX?1:-1,e=this.props.startY<=this.props.endY?1:-1,r=!1;t*(this.props.endX-this.currX)<=0&&e*(this.props.endY-this.currY)<=0&&(this.currX=this.props.endX,this.currY=this.props.endY,r=!0),this._tile.scaleX=this.currX,this._tile.scaleY=this.currY,r&&this.props.onFinish()},t}(),m=function(){function t(t,e,r){void 0===r&&(r=!1),this.SPEED=100,this.hasBeenMerged=!1,this.move=null,this.scale=null,this.scaleX=1,this.scaleY=1,this.value=e,this.color=this.getColor(e),this.hasBeenMerged=r,this.setSlot(t)}return Object.defineProperty(t.prototype,"inMove",{get:function(){return null!==this.move},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slotX",{get:function(){return this._slot.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slotY",{get:function(){return this._slot.y},enumerable:!1,configurable:!0}),t.prototype.getColor=function(t){switch(t){case 2:return"#eee4da";case 4:return"#ede0c1";case 8:return"#f2b979";case 16:return"#f5b563";case 32:return"#f6825f";case 64:return"#f46d59";case 128:return"#efda54";case 256:return"#efd443";case 512:return"#efcf32";case 1024:return"#efca21";case 2048:return"#efc712";default:return"#3cea27"}},Object.defineProperty(t.prototype,"valueOrder",{get:function(){return Math.log(this.value)/Math.log(2)},enumerable:!1,configurable:!0}),t.prototype.scaleAnimation=function(t,e){var r=this;this.scaleX=t,this.scaleY=t,this.scale=new g(this,{startX:t,startY:t,endX:1,endY:1,duration:e,onFinish:function(){r.scaleX=1,r.scaleY=1,r.scale=null}})},t.prototype.mergeAnimation=function(){var t=this;this.scaleX=1,this.scaleY=1,this.scale=new g(this,{startX:1,startY:1,endX:1.08+.02*this.valueOrder,endY:1.08+.02*this.valueOrder,duration:.5+.05*this.valueOrder,onFinish:function(){t.scale=new g(t,{startX:t.scale.currX,startY:t.scale.currY,endX:1,endY:1,duration:.5+.05*t.valueOrder,onFinish:function(){t.scale=null}})}})},Object.defineProperty(t.prototype,"X",{get:function(){return null!==this.move?this.move.currX:this.slotX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Y",{get:function(){return null!==this.move?this.move.currY:this.slotY},enumerable:!1,configurable:!0}),t.prototype.act=function(){null!==this.move&&this.move.act(),null!==this.scale&&this.scale.act()},t.prototype.draw=function(){M.translate(this.X+this._slot.width/2,this.Y+this._slot.height/2),M.scale(this.scaleX,this.scaleY),M.fillStyle=this.getColor(this.value),M.fillRect(-this._slot.width/2+2,-this._slot.height/2+2,this._slot.width-4,this._slot.height-4),M.fillStyle=this.value<5?"#000000":"#FFFFFF";var t=8+Math.abs(this._slot.width/(.3*(""+this.value).length+3));M.font="".concat(t,"px Arial"),M.textAlign="center",M.textBaseline="middle",M.fillText(""+this.value,0,0),M.scale(1,1),M.setTransform(1,0,0,1,0,0)},Object.defineProperty(t.prototype,"row",{get:function(){return this._slot.row},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._slot.col},enumerable:!1,configurable:!0}),t.prototype.canOccupy=function(t){return t.isEmpty()||t.hasOneTile()&&(t.uniqueTile.inMove||t.uniqueTile.value===this.value&&!t.uniqueTile.hasBeenMerged&&!this.hasBeenMerged)},t.prototype.moveOneStepTo=function(t,e){var r=this;this.move=new b(this,{startX:this.slotX,startY:this.slotY,endX:t.x,endY:t.y,speed:this.SPEED,onFinish:function(){r.onTileStepped(t,e)}})},t.prototype.onTileStepped=function(t,e){this.move=null,this.changeSlot(t),this._slot._table.oneTileMovedOneStep(e)},t.prototype.changeSlot=function(t){this._slot.deleteTile(this),t.addTile(this),this.setSlot(t)},t.prototype.setSlot=function(t){this._slot=t},t}(),T=function(){function e(t,e,r){this.tiles=[],this.row=e,this.col=r,this._table=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._table.X+this.width*this.col},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._table.Y+this.height*this.row},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._table.slotWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._table.slotHeight},enumerable:!1,configurable:!0}),e.prototype.existsNearSlot=function(e){var r=!0;switch(e){case t.Up:r=this.row>0;break;case t.Down:r=this.row<this._table.DIMENSION-1;break;case t.Left:r=this.col>0;break;case t.Right:r=this.col<this._table.DIMENSION-1}return r},e.prototype.isEmpty=function(){return 0===this.tiles.length},e.prototype.hasOneTile=function(){return 1===this.tiles.length},e.prototype.nearSlot=function(e){switch(e){case t.Up:return this._table.slots[this.row-1][this.col];case t.Down:return this._table.slots[this.row+1][this.col];case t.Left:return this._table.slots[this.row][this.col-1];case t.Right:return this._table.slots[this.row][this.col+1]}},Object.defineProperty(e.prototype,"uniqueTile",{get:function(){return this.tiles[0]},enumerable:!1,configurable:!0}),e.prototype.moveUniqueTileTo=function(t){var e=!1;if(this.hasOneTile()&&this.existsNearSlot(t)){var r=this.nearSlot(t);this.uniqueTile.canOccupy(r)&&(this.uniqueTile.moveOneStepTo(r,t),e=!0)}return e},e.prototype.addTile=function(t){this.tiles.push(t)},e.prototype.deleteTile=function(t){this.tiles.splice(this.tiles.indexOf(t),1)},e.prototype.hasTwoEqualTiles=function(){return 2===this.tiles.length&&this.tiles[0].value===this.tiles[1].value},e.prototype.mergeTiles=function(){var t=this.tiles[0].value;this.deleteTile(this.tiles[1]),this.deleteTile(this.tiles[0]);var e=new m(this,2*t,!0);e.mergeAnimation(),this.addTile(e)},e}(),O=function(){function e(){this.DIMENSION=4,this.X=0,this.Y=0,this.tableInMove=!1,this.slots=[];for(var t=0;t<this.DIMENSION;t++){this.slots[t]=[];for(var e=0;e<this.DIMENSION;e++)this.slots[t][e]=new T(this,t,e)}}return Object.defineProperty(e.prototype,"totalTiles",{get:function(){for(var t=[],e=0;e<this.DIMENSION;e++)for(var r=0;r<this.DIMENSION;r++)this.slots[e][r].isEmpty()||t.push.apply(t,this.slots[e][r].tiles);return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"slotWidth",{get:function(){return I.width/this.DIMENSION},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"slotHeight",{get:function(){return I.height/this.DIMENSION},enumerable:!1,configurable:!0}),e.prototype.createFirstTiles=function(){this.createRandomTile(),this.createRandomTile()},e.prototype.createRandomTile=function(t){for(var e=[],r=0;r<this.DIMENSION;r++)for(var i=0;i<this.DIMENSION;i++)this.slots[r][i].isEmpty()&&e.push(this.slots[r][i]);var n=t||(Math.random()<.9?2:4),o=Math.floor(Math.random()*e.length),s=new m(e[o],n);s.scaleAnimation(0,3),e[o].addTile(s)},e.prototype.act=function(){this.totalTiles.forEach((function(t){return t.act()}))},e.prototype.draw=function(){this.drawTable(),this.totalTiles.forEach((function(t){return t.draw()}))},e.prototype.drawTable=function(){M.fillStyle="#AAAAAA",M.fillRect(this.X,this.Y,this.slotWidth*this.DIMENSION,this.slotHeight*this.DIMENSION),M.fillStyle="#777777";for(var t=0;t<=this.DIMENSION;t++)M.fillRect(this.X+this.slotWidth*t-2,-2,4,this.slotHeight*this.DIMENSION);for(var e=0;e<=this.DIMENSION;e++)M.fillRect(-2,this.Y+this.slotHeight*e-2,this.slotWidth*this.DIMENSION,4)},e.prototype.tryMoveOneStepTo=function(e){var r=!1;switch(e){case t.Up:for(var i=0;i<this.DIMENSION;i++)for(var n=0;n<this.DIMENSION;n++)this.slots[n][i].moveUniqueTileTo(e)&&(r=!0);break;case t.Down:for(i=0;i<this.DIMENSION;i++)for(n=this.DIMENSION-1;n>=0;n--)this.slots[n][i].moveUniqueTileTo(e)&&(r=!0);break;case t.Left:for(n=0;n<this.DIMENSION;n++)for(i=0;i<this.DIMENSION;i++)this.slots[n][i].moveUniqueTileTo(e)&&(r=!0);break;case t.Right:for(n=0;n<this.DIMENSION;n++)for(i=this.DIMENSION-1;i>=0;i--)this.slots[n][i].moveUniqueTileTo(e)&&(r=!0)}return r},e.prototype.oneTileMovedOneStep=function(t){this.totalTiles.find((function(t){return t.inMove}))||this.allTilesMovedOneStep(t)},e.prototype.allTilesMovedOneStep=function(t){this.doMergers(),this.tryMoveOneStepTo(t)||this.prepareNextTurn()},e.prototype.doMergers=function(){for(var t=0;t<this.DIMENSION;t++)for(var e=0;e<this.DIMENSION;e++)this.slots[t][e].hasTwoEqualTiles()&&this.slots[t][e].mergeTiles()},e.prototype.prepareNextTurn=function(){this.totalTiles.forEach((function(t){return t.hasBeenMerged=!1})),this.createRandomTile(),this.tableInMove=!1},e}(),w=function(){function t(){this.started=!1}return t.prototype.start=function(){this.table=new O,this.table.createFirstTiles(),this.started=!0},t.prototype.render=function(){this.clearScreen(),this.table.act(),this.table.draw()},t.prototype.clearScreen=function(){M.clearRect(0,0,I.width,I.height)},t.prototype.checkOrderTo=function(t){this.table.tableInMove||this.table.tryMoveOneStepTo(t)&&(this.table.tableInMove=!0)},t}(),I=document.getElementById("gameCanvas"),M=I.getContext("2d"),S=document.getElementById("canvasContainer");function N(){I&&(I.width=S.offsetWidth,I.height=1*I.width)}N(),window.addEventListener("resize",(function(){return N()}));var X=new w;X.start(),document.addEventListener("keydown",(function(e){e.preventDefault();var r=e.key;"ArrowLeft"===r?X.checkOrderTo(t.Left):"ArrowUp"===r?X.checkOrderTo(t.Up):"ArrowRight"===r?X.checkOrderTo(t.Right):"ArrowDown"===r&&X.checkOrderTo(t.Down)}));var Y=null,E=null;S.addEventListener("touchstart",(function(t){t.preventDefault(),console.log("start",t),Y=t.touches[0].clientX,E=t.touches[0].clientY})),S.addEventListener("touchmove",(function(e){e.preventDefault();var r=e.touches[0].clientX,i=e.touches[0].clientY;Y&&r-Y>=10?(Y=r,E=i,X.checkOrderTo(t.Right)):Y&&r-Y<=-10&&(Y=r,E=i,X.checkOrderTo(t.Left)),E&&i-E>=10?(Y=r,E=i,X.checkOrderTo(t.Down)):E&&i-E<=-10&&(Y=r,E=i,X.checkOrderTo(t.Up))})),document.querySelector(".restart").addEventListener("click",(function(){console.log("restart"),X.start()})),function t(){X&&X.started&&X.render(),requestAnimationFrame(t)}()})()})();