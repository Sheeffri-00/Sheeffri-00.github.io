(()=>{"use strict";var t,e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};e.d({},{JQ:()=>l,Cn:()=>a}),function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(t||(t={}));var s=function(){function t(t,e){this._tile=t,this.props=e,this.currX=e.startX,this.currY=e.startY,this.props.endX,this.currX,this.props.endY,this.currY,this.velX=(this.props.endX-this.props.startX)/5,this.velY=(this.props.endY-this.props.startY)/5}return t.prototype.act=function(){this.currX+=this.velX,this.currY+=this.velY;var t=Math.abs(this.props.endX-this.currX),e=Math.abs(this.props.endY-this.currY),s=!1;t<=.1&&e<=.1&&(this.currX=this.props.endX,this.currY=this.props.endY,s=!0),this._tile.x=this.currX,this._tile.y=this.currY,s&&this.props.onFinish()},t}(),i=function(){function t(t,e){this._tile=t,this.props=e,this.currX=this.props.startX,this.currY=this.props.startY,this.props.endX,this.currX,this.props.endY,this.currY,this.velX=(this.props.endX-this.props.startX)/this.props.duration/5,this.velY=(this.props.endY-this.props.startY)/this.props.duration/5}return t.prototype.act=function(){this.currX+=this.velX,this.currY+=this.velY;var t=this.props.startX<=this.props.endX?1:-1,e=this.props.startY<=this.props.endY?1:-1,s=!1;t*(this.props.endX-this.currX)<=0&&e*(this.props.endY-this.currY)<=0&&(this.currX=this.props.endX,this.currY=this.props.endY,s=!0),this._tile.scaleX=this.currX,this._tile.scaleY=this.currY,s&&this.props.onFinish()},t}(),r=function(){function t(t,e,s){void 0===s&&(s=!1),this.SPEED=100,this.hasBeenMerged=!1,this.move=null,this.scale=null,this.scaleX=1,this.scaleY=1,this.value=e,this.color=this.getColor(e),this.hasBeenMerged=s,this.setSlot(t)}return Object.defineProperty(t.prototype,"inMove",{get:function(){return null!==this.move},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slotX",{get:function(){return this._slot.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slotY",{get:function(){return this._slot.y},enumerable:!1,configurable:!0}),t.prototype.getColor=function(t){switch(t){case 2:return"#eee4da";case 4:return"#ede0c1";case 8:return"#f2b979";case 16:return"#f5b563";case 32:return"#f67c5f";case 64:return"#f46d59";case 128:return"#efda54";case 256:return"#efd443";case 512:return"#efcf32";case 1024:return"#efca21";case 2048:return"#efc712";default:return"#3cea27"}},Object.defineProperty(t.prototype,"valueOrder",{get:function(){return Math.log(this.value)/Math.log(2)},enumerable:!1,configurable:!0}),t.prototype.scaleAnimation=function(t,e){var s=this;this.scaleX=t,this.scaleY=t,this.scale=new i(this,{startX:t,startY:t,endX:1,endY:1,duration:e,onFinish:function(){s.scaleX=1,s.scaleY=1,s.scale=null}})},t.prototype.mergeAnimation=function(){var t=this;this.scaleX=1,this.scaleY=1,this.scale=new i(this,{startX:1,startY:1,endX:1.08+.02*this.valueOrder,endY:1.08+.02*this.valueOrder,duration:.5+.05*this.valueOrder,onFinish:function(){t.scale=new i(t,{startX:t.scale.currX,startY:t.scale.currY,endX:1,endY:1,duration:.5+.05*t.valueOrder,onFinish:function(){t.scale=null}})}})},t.prototype.act=function(){null!==this.move&&this.move.act(),null!==this.scale&&this.scale.act()},t.prototype.draw=function(){a.translate(this.x+this._slot.size/2,this.y+this._slot.size/2),a.scale(this.scaleX,this.scaleY),a.fillStyle=this.getColor(this.value),a.fillRect(-this._slot.size/2+3,-this._slot.size/2+3,this._slot.size-4,this._slot.size-4),a.fillStyle=this.value<5?"#000000":"#FFFFFF";var t=this.value<100?54:this.value<1e3?43:this.value<1e4?32:22;a.font="".concat(t,"px Arial"),a.textAlign="center",a.textBaseline="middle",a.fillText(""+this.value,0,0),a.scale(1,1),a.setTransform(1,0,0,1,0,0)},Object.defineProperty(t.prototype,"row",{get:function(){return this._slot.row},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._slot.col},enumerable:!1,configurable:!0}),t.prototype.canOccupy=function(t){return t.isEmpty()||t.hasOneTile()&&(t.uniqueTile.inMove||t.uniqueTile.value===this.value&&!t.uniqueTile.hasBeenMerged&&!this.hasBeenMerged)},t.prototype.moveOneStepTo=function(t,e){var i=this;this.move=new s(this,{startX:this.slotX,startY:this.slotY,endX:t.x,endY:t.y,speed:this.SPEED,onFinish:function(){i.onTileStepped(t,e)}})},t.prototype.onTileStepped=function(t,e){this.move=null,this.changeSlot(t),this._slot._table.oneTileMovedOneStep(e)},t.prototype.changeSlot=function(t){this._slot.deleteTile(this),t.addTile(this),this.setSlot(t)},t.prototype.setSlot=function(t){this._slot=t,this.x=this.slotX,this.y=this.slotY},t}(),o=function(){function e(t,e,s){this.tiles=[],this.row=e,this.col=s,this._table=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._table.X+this.size*this.col},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._table.Y+this.size*this.row},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._table.SLOT_SIZE},enumerable:!1,configurable:!0}),e.prototype.existsNearSlot=function(e){var s=!0;switch(e){case t.Up:s=this.row>0;break;case t.Down:s=this.row<this._table.DIMENSION-1;break;case t.Left:s=this.col>0;break;case t.Right:s=this.col<this._table.DIMENSION-1}return s},e.prototype.isEmpty=function(){return 0===this.tiles.length},e.prototype.hasOneTile=function(){return 1===this.tiles.length},e.prototype.nearSlot=function(e){switch(e){case t.Up:return this._table.slots[this.row-1][this.col];case t.Down:return this._table.slots[this.row+1][this.col];case t.Left:return this._table.slots[this.row][this.col-1];case t.Right:return this._table.slots[this.row][this.col+1]}},Object.defineProperty(e.prototype,"uniqueTile",{get:function(){return this.tiles[0]},enumerable:!1,configurable:!0}),e.prototype.moveUniqueTileTo=function(t){var e=!1;if(this.hasOneTile()&&this.existsNearSlot(t)){var s=this.nearSlot(t);this.uniqueTile.canOccupy(s)&&(this.uniqueTile.moveOneStepTo(s,t),e=!0)}return e},e.prototype.addTile=function(t){this.tiles.push(t)},e.prototype.deleteTile=function(t){this.tiles.splice(this.tiles.indexOf(t),1)},e.prototype.hasTwoEqualTiles=function(){return 2===this.tiles.length&&this.tiles[0].value===this.tiles[1].value},e.prototype.mergeTiles=function(){var t=this.tiles[0].value;this.deleteTile(this.tiles[1]),this.deleteTile(this.tiles[0]);var e=new r(this,2*t,!0);e.mergeAnimation(),this.addTile(e)},e}(),n=function(){function e(){this.DIMENSION=4,this.SLOT_SIZE=100,this.X=0,this.Y=0,this.tableInMove=!1,this.slots=[];for(var t=0;t<this.DIMENSION;t++){this.slots[t]=[];for(var e=0;e<this.DIMENSION;e++)this.slots[t][e]=new o(this,t,e)}}return Object.defineProperty(e.prototype,"totalTiles",{get:function(){for(var t=[],e=0;e<this.DIMENSION;e++)for(var s=0;s<this.DIMENSION;s++)this.slots[e][s].isEmpty()||t.push.apply(t,this.slots[e][s].tiles);return t},enumerable:!1,configurable:!0}),e.prototype.createFirstTiles=function(){this.createRandomTile(),this.createRandomTile()},e.prototype.createRandomTile=function(t){for(var e=[],s=0;s<this.DIMENSION;s++)for(var i=0;i<this.DIMENSION;i++)this.slots[s][i].isEmpty()&&e.push(this.slots[s][i]);var o=t||(Math.random()<.9?2:4),n=Math.floor(Math.random()*e.length),h=new r(e[n],o);h.scaleAnimation(0,3),e[n].addTile(h)},e.prototype.act=function(){this.totalTiles.forEach((function(t){return t.act()}))},e.prototype.draw=function(){this.drawTable(),this.totalTiles.forEach((function(t){return t.draw()}))},e.prototype.drawTable=function(){a.fillStyle="#AAAAAA",a.fillRect(this.X,this.Y,this.SLOT_SIZE*this.DIMENSION,this.SLOT_SIZE*this.DIMENSION),a.strokeStyle="#777777";for(var t=0;t<=this.DIMENSION;t++)a.strokeRect(this.X+this.SLOT_SIZE*t,0,0===t||t===this.DIMENSION?1:2,this.SLOT_SIZE*this.DIMENSION);for(var e=0;e<=this.DIMENSION;e++)a.strokeRect(0,this.Y+this.SLOT_SIZE*e,this.SLOT_SIZE*this.DIMENSION,0===e||e===this.DIMENSION?1:2)},e.prototype.tryMoveOneStepTo=function(e){var s=!1;switch(e){case t.Up:for(var i=0;i<this.DIMENSION;i++)for(var r=0;r<this.DIMENSION;r++)this.slots[r][i].moveUniqueTileTo(e)&&(s=!0);break;case t.Down:for(i=0;i<this.DIMENSION;i++)for(r=this.DIMENSION-1;r>=0;r--)this.slots[r][i].moveUniqueTileTo(e)&&(s=!0);break;case t.Left:for(r=0;r<this.DIMENSION;r++)for(i=0;i<this.DIMENSION;i++)this.slots[r][i].moveUniqueTileTo(e)&&(s=!0);break;case t.Right:for(r=0;r<this.DIMENSION;r++)for(i=this.DIMENSION-1;i>=0;i--)this.slots[r][i].moveUniqueTileTo(e)&&(s=!0)}return s},e.prototype.oneTileMovedOneStep=function(t){this.totalTiles.find((function(t){return t.inMove}))||this.allTilesMovedOneStep(t)},e.prototype.allTilesMovedOneStep=function(t){this.doMergers(),this.tryMoveOneStepTo(t)||this.prepareNextTurn()},e.prototype.doMergers=function(){for(var t=0;t<this.DIMENSION;t++)for(var e=0;e<this.DIMENSION;e++)this.slots[t][e].hasTwoEqualTiles()&&this.slots[t][e].mergeTiles()},e.prototype.prepareNextTurn=function(){this.totalTiles.forEach((function(t){return t.hasBeenMerged=!1})),this.createRandomTile(),this.tableInMove=!1},e}(),h=function(){function t(){this.started=!1}return t.prototype.start=function(){this.table=new n,this.table.createFirstTiles(),this.started=!0},t.prototype.render=function(){this.clearScreen(),this.table.act(),this.table.draw()},t.prototype.clearScreen=function(){a.clearRect(0,0,l.width,l.height)},t.prototype.checkOrderTo=function(t){this.table.tableInMove||this.table.tryMoveOneStepTo(t)&&(this.table.tableInMove=!0)},t}(),l=document.getElementById("gameCanvas"),a=l.getContext("2d"),c=new h;c.start(),document.addEventListener("keydown",(function(e){e.preventDefault();var s=e.key;"ArrowLeft"===s?c.checkOrderTo(t.Left):"ArrowUp"===s?c.checkOrderTo(t.Up):"ArrowRight"===s?c.checkOrderTo(t.Right):"ArrowDown"===s&&c.checkOrderTo(t.Down)})),function t(){c&&c.started&&c.render(),requestAnimationFrame(t)}()})();